<sequence version="3.10"><step type="SMS_TaskSequence_SetVariableAction" name="README" description="" runIn="WinPEandFullOS" successCodeList="0" retryCount="0" runFromNet="false"><action>tsenv.exe "README=This task sequence demonstrates using the variable OSDDoNotLogCommand, when set to TRUE the ProgramName value is not shown in logs. Open SMSTS.log from %windir%\CCM\Logs on task sequence completion to see the effects. This is useful in cases where credentials or other secrets are used in the command line. See https://docs.microsoft.com/en-us/mem/configmgr/osd/understand/task-sequence-variables for more information." /hiddenflag:False</action><defaultVarList><variable name="DoNotShowVariableValue" property="DoNotShowVariableValue" hidden="true">false</variable><variable name="VariableName" property="VariableName" hidden="true">README</variable><variable name="VariableValue" property="VariableValue" hidden="true">This task sequence demonstrates using the variable OSDDoNotLogCommand, when set to TRUE the ProgramName value is not shown in logs. Open SMSTS.log from %windir%\CCM\Logs on task sequence completion to see the effects. This is useful in cases where credentials or other secrets are used in the command line. See https://docs.microsoft.com/en-us/mem/configmgr/osd/understand/task-sequence-variables for more information.</variable></defaultVarList></step><group name="Tidy Up From Previous Run" description="Uses Continue on error if folder is not present" continueOnError="true"><step type="SMS_TaskSequence_RunCommandLineAction" name="Clean folder contents" description="" continueOnError="true" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><condition><expression type="SMS_TaskSequence_FolderConditionExpression"><variable name="Path">C:\TS-1000</variable></expression></condition><action>smsswd.exe /run: cmd /c del C:\SMSTS-ProgramName-Logging\*.txt</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c del C:\SMSTS-ProgramName-Logging\*.txt</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="SMSTSRunCommandLineOutputVariableName" property="OutputVariableName"></variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><step type="SMS_TaskSequence_RunCommandLineAction" name="Remove folder before creating another" description="" continueOnError="true" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd /c rd C:\SMSTS-ProgramName-Logging</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c rd C:\SMSTS-ProgramName-Logging</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><group name="Ten Run Command Lines to demonstrate the variable" description="Used to show the effects the variable has on Run Command Line logging"><step type="SMS_TaskSequence_RunCommandLineAction" name="Create a new Folder for the demonstration" description="Create C:\SMSTS-ProgramName-Logging" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd /c md C:\SMSTS-ProgramName-Logging</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c md C:\SMSTS-ProgramName-Logging</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><step type="SMS_TaskSequence_RunCommandLineAction" name="Run Command Line - 1" description="Using 'Dir' so the step does not complete too quickly and not allow user time to view logs" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\1.txt</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\1.txt</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><step type="SMS_TaskSequence_SetVariableAction" name="OSDDoNotLogCommand=TRUE" description="With this variable set ProgramName will not be logged - open SMSTS.log to view" runIn="WinPEandFullOS" successCodeList="0" retryCount="0" runFromNet="false"><action>tsenv.exe "OSDDoNotLogCommand=TRUE" /hiddenflag:False</action><defaultVarList><variable name="DoNotShowVariableValue" property="DoNotShowVariableValue" hidden="true">false</variable><variable name="VariableName" property="VariableName" hidden="true">OSDDoNotLogCommand</variable><variable name="VariableValue" property="VariableValue" hidden="true">TRUE</variable></defaultVarList></step><step type="SMS_TaskSequence_RunCommandLineAction" name="Run Command Line - 2" description="In this step the log will show &quot;Start executing the command line: &lt; Command line NOT shown in log since TS variable 'OSDDoNotLogCommand' is set to 'True' &gt;&quot;" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\2.txt</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\2.txt</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><step type="SMS_TaskSequence_RunCommandLineAction" name="Run Command Line - 3" description="In this step the log will show &quot;Start executing the command line: &lt; Command line NOT shown in log since TS variable 'OSDDoNotLogCommand' is set to 'True' &gt;&quot;" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\3.txt</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\3.txt</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><step type="SMS_TaskSequence_RunCommandLineAction" name="Run Command Line - 4" description="In this step the log will show &quot;Start executing the command line: &lt; Command line NOT shown in log since TS variable 'OSDDoNotLogCommand' is set to 'True' &gt;&quot;" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\4.txt</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\4.txt</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><step type="SMS_TaskSequence_RunCommandLineAction" name="Run Command Line - 5" description="In this step the log will show &quot;Start executing the command line: &lt; Command line NOT shown in log since TS variable 'OSDDoNotLogCommand' is set to 'True' &gt;&quot;" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\5.txt</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\5.txt</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><step type="SMS_TaskSequence_RunCommandLineAction" name="Run Command Line - 6" description="In this step the log will show &quot;Start executing the command line: &lt; Command line NOT shown in log since TS variable 'OSDDoNotLogCommand' is set to 'True' &gt;&quot;" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\6.txt</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\6.txt</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><step type="SMS_TaskSequence_RunCommandLineAction" name="Run Command Line - 7" description="In this step the log will show &quot;Start executing the command line: &lt; Command line NOT shown in log since TS variable 'OSDDoNotLogCommand' is set to 'True' &gt;&quot;" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\7.txt</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\7.txt</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><step type="SMS_TaskSequence_SetVariableAction" name="OSDDoNotLogCommand=FALSE" description="With this variable set to False ProgramName will now be logged again - open SMSTS.log to view. This can be used when passing credentials or secrets in command line actions." runIn="WinPEandFullOS" successCodeList="0" retryCount="0" runFromNet="false"><action>tsenv.exe "OSDDoNotLogCommand=FALSE" /hiddenflag:False</action><defaultVarList><variable name="DoNotShowVariableValue" property="DoNotShowVariableValue" hidden="true">false</variable><variable name="VariableName" property="VariableName" hidden="true">OSDDoNotLogCommand</variable><variable name="VariableValue" property="VariableValue" hidden="true">FALSE</variable></defaultVarList></step><step type="SMS_TaskSequence_RunCommandLineAction" name="Run Command Line - 8" description="In this step the log will show ProgramName is being logged ('OSDDoNotLogCommand' is not set to 'True') &amp; ProgramName = 'cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\8.txt'" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\8.txt</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\8.txt</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><step type="SMS_TaskSequence_RunCommandLineAction" name="Run Command Line - 9" description="In this step the log will show ProgramName is being logged ('OSDDoNotLogCommand' is not set to 'True') &amp; ProgramName = 'cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\9.txt'" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\9.txt</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\9.txt</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><step type="SMS_TaskSequence_RunCommandLineAction" name="Run Command Line - 10" description="In this step the log will show ProgramName is being logged ('OSDDoNotLogCommand' is not set to 'True') &amp; ProgramName = 'cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\10.txt'" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\10.txt</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c dir &gt; C:\SMSTS-ProgramName-Logging\10.txt</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><step type="SMS_TaskSequence_RunCommandLineAction" name="Run Command Line - End Of Group" description="" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd /c dir /s &gt; C:\SMSTS-ProgramName-Logging\A.txt</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c dir /s &gt; C:\SMSTS-ProgramName-Logging\A.txt</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step></group></group><step type="SMS_TaskSequence_RunCommandLineAction" name="Task Sequence Complete  - Tidy up Files" description="Clean up any files created during the task sequence" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd /c del c:\SMSTS-ProgramName-Logging\*.txt</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c del c:\SMSTS-ProgramName-Logging\*.txt</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step><step type="SMS_TaskSequence_RunCommandLineAction" name="Task Sequence Complete  - Remove folder" description="" runIn="WinPEandFullOS" successCodeList="0 3010" retryCount="0" runFromNet="false"><action>smsswd.exe /run: cmd /c rd C:\SMSTS-ProgramName-Logging</action><defaultVarList><variable name="CommandLine" property="CommandLine" hidden="true">cmd /c rd C:\SMSTS-ProgramName-Logging</variable><variable name="SMSTSDisableWow64Redirection" property="DisableWow64Redirection">false</variable><variable name="_SMSTSRunCommandLineAsUser" property="RunAsUser">false</variable><variable name="SuccessCodes" property="SuccessCodes" hidden="true">0 3010</variable></defaultVarList></step></sequence>
