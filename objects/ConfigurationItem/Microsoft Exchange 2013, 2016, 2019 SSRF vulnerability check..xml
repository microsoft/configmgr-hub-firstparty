<?xml version="1.0" encoding="utf-16"?>
<DesiredConfigurationDigest xmlns="http://schemas.microsoft.com/SystemsCenterConfigurationManager/2009/07/10/DesiredConfiguration">
  <!--Authored against the following schema version: 5-->
  <Application AuthoringScopeId="ScopeId_A940389B-59E9-4F75-89A6-B4E00C506A52" LogicalName="Application_445ae744-4685-4007-ac46-c44b75f23e8b" Version="7" Is64Bit="true">
    <Annotation xmlns="http://schemas.microsoft.com/SystemsCenterConfigurationManager/2009/06/14/Rules">
      <DisplayName Text="Microsoft Exchange 2013, 2016, 2019 SSRF vulnerability check." ResourceId="ID-c6926462-11ea-48ab-aa6e-5f3e0fe995fa" />
      <Description Text="This Configuration Item will check if the following Microsoft Exchange SSRF vulnerabilities exist: &#xA;&#xA;CVE-2021-26855&#xA;CVE-2021-26857&#xA;CVE-2021-26858&#xA;CVE-2021-27065" ResourceId="ID-94bca127-18a5-4d37-8e59-728271e47f39" />
    </Annotation>
    <Parts>
      <SuppressionReferences />
    </Parts>
    <Settings>
      <RootComplexSetting>
        <SimpleSetting LogicalName="RegSetting_a71b27a6-31a8-4799-a6af-71dee228b79e" DataType="String">
          <Annotation xmlns="http://schemas.microsoft.com/SystemsCenterConfigurationManager/2009/06/14/Rules">
            <DisplayName Text="Setting for Exchange versions 2013, 2016, 2019" ResourceId="ID-4b270bda-e3cc-4ee3-820e-bdaee503bcfd" />
            <Description Text="This setting checks the registry for the InterimUpdate value for Microsoft Exchange Versions 2013, 2016, and 2019." ResourceId="ID-c6c5d13b-9ef8-4d73-923b-a9b6730fa361" />
          </Annotation>
          <RegistryDiscoverySource Hive="HKEY_LOCAL_MACHINE" Depth="Base" Is64Bit="true" CreateMissingPath="true">
            <Key>SOFTWARE\Microsoft\ExchangeServer\v15\Setup</Key>
            <ValueName>InterimUpdate</ValueName>
          </RegistryDiscoverySource>
        </SimpleSetting>
      </RootComplexSetting>
    </Settings>
    <Rules>
      <Rule xmlns="http://schemas.microsoft.com/SystemsCenterConfigurationManager/2009/06/14/Rules" id="Rule_6f01edf4-659b-49c2-a191-c77950f00566" Severity="Critical" NonCompliantWhenSettingIsNotFound="false">
        <Annotation>
          <DisplayName Text="InterimUpdate value must be 5000871" ResourceId="ID-59f5bf71-c57f-41e5-b539-c9308ccea61d" />
          <Description Text="This rule requires that the 'InterimUpdate' value must contain the value 5000871 which indicates this version of Microsoft Exchange Server has been patched." ResourceId="ID-4f746c2b-d59f-4877-83ce-40b251d998f7" />
        </Annotation>
        <Expression>
          <Operator>Equals</Operator>
          <Operands>
            <SettingReference AuthoringScopeId="ScopeId_A940389B-59E9-4F75-89A6-B4E00C506A52" LogicalName="Application_445ae744-4685-4007-ac46-c44b75f23e8b" Version="7" DataType="String" SettingLogicalName="RegSetting_a71b27a6-31a8-4799-a6af-71dee228b79e" SettingSourceType="Registry" Method="Value" Changeable="false" />
            <ConstantValue Value="5000871" DataType="String" />
          </Operands>
        </Expression>
      </Rule>
      <Rule xmlns="http://schemas.microsoft.com/SystemsCenterConfigurationManager/2009/06/14/Rules" id="Rule_631ea9bd-84c6-476a-8617-2dfc0e147af3" Severity="Critical" NonCompliantWhenSettingIsNotFound="false">
        <Annotation>
          <DisplayName Text="InterimUpdate value must exist" ResourceId="ID-91c861c9-e2a4-4433-a920-2869a732f19b" />
          <Description Text="This rule requires that the 'InterimUpdate' value must exist which indicates this version of Microsoft Exchange Server has not been patched." ResourceId="ID-9ca03db4-68ef-4b97-a88d-50e9a5b956ad" />
        </Annotation>
        <Expression>
          <Operator>NotEquals</Operator>
          <Operands>
            <SettingReference AuthoringScopeId="ScopeId_A940389B-59E9-4F75-89A6-B4E00C506A52" LogicalName="Application_445ae744-4685-4007-ac46-c44b75f23e8b" Version="7" DataType="Int64" SettingLogicalName="RegSetting_a71b27a6-31a8-4799-a6af-71dee228b79e" SettingSourceType="Registry" Method="Count" Changeable="false" />
            <ConstantValue Value="0" DataType="Int64" />
          </Operands>
        </Expression>
      </Rule>
    </Rules>
    <PlatformApplicabilityCondition xmlns="http://schemas.microsoft.com/SystemsCenterConfigurationManager/2009/06/14/Rules">
      <OperatingSystemExpression>
        <Operator>OneOf</Operator>
        <Operands>
          <RuleExpression RuleId="Windows/All_x64_Windows_Server_2008" />
          <RuleExpression RuleId="Windows/All_x64_Windows_Server_2008_R2" />
          <RuleExpression RuleId="Windows/All_x86_Windows_Server_2008" />
          <RuleExpression RuleId="Windows/x64_Windows_Server_2008_R2" />
          <RuleExpression RuleId="Windows/x64_Windows_Server_2008_R2_CORE" />
          <RuleExpression RuleId="Windows/x64_Windows_Server_2008_R2_SP1" />
          <RuleExpression RuleId="Windows/x64_Windows_Server_2008_R2_SP1_Core" />
          <RuleExpression RuleId="Windows/x64_Windows_Server_2008_SP2" />
          <RuleExpression RuleId="Windows/x64_Windows_Server_2008_SP2_Core" />
          <RuleExpression RuleId="Windows/x86_Windows_Server_2008_SP2" />
          <RuleExpression RuleId="Windows/All_x64_Windows_Server_8" />
          <RuleExpression RuleId="Windows/All_x64_Windows_Server_2012_R2" />
          <RuleExpression RuleId="Windows/All_x64_Windows_Server_2016" />
          <RuleExpression RuleId="Windows/All_x64_Windows_Server_2019_and_higher" />
        </Operands>
      </OperatingSystemExpression>
    </PlatformApplicabilityCondition>
    <ScriptDiscoveryInfo ScriptType="PowerShell">
      <Script>$installed = Test-Path -Path "HKLM:\SOFTWARE\Microsoft\ExchangeServer\v15"

if ($installed -eq "True")
{
    Write-Host "Exchange server is installed.";
}</Script>
    </ScriptDiscoveryInfo>
  </Application>
</DesiredConfigurationDigest>